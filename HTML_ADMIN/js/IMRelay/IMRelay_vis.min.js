$(document).ready(function(){"use strict";function p(n){var t=document.createElement("div"),i,e,o,r,s,u,h,f,c;return t.className="vis_controls btn-group btn-group-sm",t.role="group",t.id="vis_controls_id_"+n,i=document.createElement("div"),i.className="btn btn-default disabled",e=document.createElement("div"),e.innerText=n,i.appendChild(e),o=document.createElement("i"),o.className="fa",i.appendChild(o),t.appendChild(i),r=document.createElement("button"),r.className="btn btn-default",r.type="button",s=document.createElement("i"),s.className="fa fa-play",r.appendChild(s),t.appendChild(r),u=document.createElement("button"),u.className="btn btn-default",u.type="button",h=document.createElement("i"),h.className="fa fa-pause",u.appendChild(h),t.appendChild(u),f=document.createElement("button"),f.className="btn btn-default",f.type="button",c=document.createElement("i"),c.className="fa fa-stop",f.appendChild(c),t.appendChild(f),t}function w(t){var r=[{id:1,time_feeding_intervals:0},{id:2,time_feeding_intervals:0},{id:3,time_feeding_intervals:0},{id:4,time_feeding_intervals:0},{id:5,time_feeding_intervals:0},{id:6,time_feeding_intervals:0},{id:7,time_feeding_intervals:0},{id:8,time_feeding_intervals:0},{id:9,time_feeding_intervals:0},{id:10,time_feeding_intervals:0},{id:11,time_feeding_intervals:0},{id:12,time_feeding_intervals:0},{id:13,time_feeding_intervals:0},{id:14,time_feeding_intervals:0},{id:15,time_feeding_intervals:0},{id:16,time_feeding_intervals:0}];for(var i in t)t[i].start=new Date(t[i].start).setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t[i].end=new Date(t[i].end).setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),r[t[i].group-1].time_feeding_intervals+=(t[i].end-t[i].start)/1e3;g_LDA.feeding_table.update(r)}function s(t,i){b(t)?i(null):t.start<n?i(null):t.end>u?i(null):t.start>=t.end?i(null):(t.content=moment(t.start).format("HH:mm:ss")+" - "+moment(t.end).format("HH:mm:ss"),i(t))}function b(n){for(var t in g_LDA.items._data)if(g_LDA.items._data[t].group==n.group&&g_LDA.items._data[t].id!=n.id&&(n.start>=g_LDA.items._data[t].start&&n.start<=g_LDA.items._data[t].end||n.end>=g_LDA.items._data[t].start&&n.end<=g_LDA.items._data[t].end||n.start<=g_LDA.items._data[t].start&&n.end>=g_LDA.items._data[t].end))return 1;return 0}function k(n){$("#vis_controls_id_"+n+" button:nth-child(2)").click(function(){$("#vis_controls_id_"+n+" div:nth-child(1)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(2)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(3)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(4)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default");g_LDA.feeding_table.update({id:n,state:"feeder"})});$("#vis_controls_id_"+n+" button:nth-child(3)").click(function(){$("#vis_controls_id_"+n+" div:nth-child(1)").removeClass("btn-success").addClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(2)").removeClass("btn-success").addClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(3)").removeClass("btn-success").addClass("btn-warning").removeClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(4)").removeClass("btn-success").addClass("btn-warning").removeClass("btn-default");g_LDA.feeding_table.update({id:n,state:"feeder"})});$("#vis_controls_id_"+n+" button:nth-child(4)").click(function(){$("#vis_controls_id_"+n+" div:nth-child(1)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(2)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(3)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(4)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");g_LDA.feeding_table.update({id:n,state:"inactive"})})}function d(n){return $.inArray(n,["state","start_time","end_time","time_on","time_off"])!==-1?!0:!1}function g(n){var t=document.createElement("button");return t.className="btn btn-default event_table_toogle_edit_button",t.type="button",t.dataset.id=n,t.innerText="Edit",'<td style="width:65px;">'+t.outerHTML+"<\/td>"}function nt(n,t,i){var u=n.attributeWriter(t),r="<td";return(n.hidden||n.textAlign)&&(r+=' style="',n.textAlign&&(r+="text-align: "+n.textAlign+";"),r+='"'),i&&(r+=' class="user_editable"'),r+">"+u+"<\/td>"}function tt(n,t,i,r){var f,u,e;for(t.relay_number=t.group,t.start_time=moment(t.start).format("HH:mm:ss"),t.end_time=moment(t.end).format("HH:mm:ss"),t.state=t.group,f="",f+=g(t.id),u=1,e=i.length;u<e;u++)f+=r(i[u],t,d(i[u].id));return"<tr>"+f+"<\/tr>"}function y(n){if(n.match(/^(?:2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9]$/)){var t=new Date,i=n.split(":"),r=parseInt(i[0],10),u=parseInt(i[1],10),f=parseInt(i[2],10);return t.setHours(r),t.setMinutes(u),t.setSeconds(f),t}return!1}function it(n){var i=n.edit,t=g_LDA.items.get(i);t.start=y(n.start_time);t.end=y(n.end_time);t.className="vis_item_relay_event";s(t,function(n){g_LDA.items.update([n])})}var i,n,u,e,o,l,a,v,f,h,c,r,t;for(g_LDA.groups=new vis.DataSet,i=1;i<=16;i++)g_LDA.groups.add({id:i,className:"vis_group_disabled",content:p(i),value:i});g_LDA.groups.on("*",function(){for(var t=g_LDA.groups.get({fields:["id","className"]}),n=0;n<16;n++)t[n].className==="vis_group_disabled"?$("#vis_controls_id_"+(n+1)+" div:nth-child(1) i").removeClass("fa-cutlery").removeClass("fa-plug").addClass("fa-ban"):g_LDA.relay[n].type==="generic"?$("#vis_controls_id_"+(n+1)+" div:nth-child(1) i").removeClass("fa-cutlery").addClass("fa-plug").removeClass("fa-ban"):$("#vis_controls_id_"+(n+1)+" div:nth-child(1) i").addClass("fa-cutlery").removeClass("fa-plug").removeClass("fa-ban");localStorage["timeline.groups"]=JSON.stringify(t)});n=new Date;n.setHours(0,0,0,0);u=new Date;u.setTime(n.getTime()+864e5);g_LDA.items=new vis.DataSet;e=localStorage["timeline.items"];e!=null&&(o=JSON.parse(e),w(o),g_LDA.items._data=o,localStorage["timeline.items"]=JSON.stringify(g_LDA.items._data));g_LDA.items.on("*",function(){var i,n;localStorage["timeline.items"]=JSON.stringify(g_LDA.items._data);i=[{id:1,time_feeding_intervals:0},{id:2,time_feeding_intervals:0},{id:3,time_feeding_intervals:0},{id:4,time_feeding_intervals:0},{id:5,time_feeding_intervals:0},{id:6,time_feeding_intervals:0},{id:7,time_feeding_intervals:0},{id:8,time_feeding_intervals:0},{id:9,time_feeding_intervals:0},{id:10,time_feeding_intervals:0},{id:11,time_feeding_intervals:0},{id:12,time_feeding_intervals:0},{id:13,time_feeding_intervals:0},{id:14,time_feeding_intervals:0},{id:15,time_feeding_intervals:0},{id:16,time_feeding_intervals:0}];for(n in g_LDA.items._data)i[g_LDA.items._data[n].group-1].time_feeding_intervals+=(g_LDA.items._data[n].end-g_LDA.items._data[n].start)/1e3;g_LDA.feeding_table.update(i);t.settings.dataset.originalRecords=g_LDA.items.get();t.queries.remove("relay_number");t.process();t.queries.add("relay_number",$("input[name=event_relay]:checked").val());t.process()});for(l={align:"center",autoResize:!0,editable:{add:!0,remove:!0,updateGroup:!1,updateTime:!0},end:u,groupOrder:function(n,t){return n.value-t.value},margin:{axis:0,item:6},max:u,min:n,onAdd:s,onMove:s,onRemove:function(n,t){confirm("Remove item from relay "+n.group+"? ("+n.content+")")?t(n):t(null)},orientation:"bottom",selectable:!0,showCurrentTime:!0,showCustomTime:!1,showMajorLabels:!0,showMinorLabels:!0,stack:!1,start:n,type:"range",width:"auto",zoomMax:864e5,zoomMin:6e4},a=document.getElementById("vis_timeline"),v=new vis.Timeline(a,g_LDA.items,l),v.setGroups(g_LDA.groups),f=1;f<=16;f++)k(f);if(h=localStorage["timeline.groups"],h!=null)for(c=JSON.parse(h),g_LDA.groups.update(c),r=0;r<16;r++)c[r].className=="vis_group_disabled"?disable_vis_timeline_button_classes(r+1):enable_vis_timeline_button_classes(r+1);$("#event_table").dynatable({features:{paginate:!1,search:!1,recordCount:!1},dataset:{records:g_LDA.items.get()},writers:{_rowWriter:tt,_cellWriter:nt},inputs:{queries:$("input[name=inlineRadioOptions]")}});$("#event_table").on("click","button.event_table_toogle_edit_button",function(){var i=jQuery(this).closest("tr"),u=i.find("td"),r=i.find("td.user_editable"),t=r.is(".active"),n;this.innerHTML=t?"Edit":"Save";r.prop("contenteditable",!t).toggleClass("active");t&&(n={},jQuery.each(u,function(t,i){var r=$(this).parents("table").find("th").eq(t);r=r.text().replace(/\s+/g,"_").replace(/\#/g,"nr").toLowerCase();n[r]=i.innerHTML}),n.edit=$(this).data("id"),it(n))});t=$("#event_table").data("dynatable");t.queries.add("relay_number",1);t.process();$("#update_relay_type_setting").click(function(){var t=$("#relay_state_chooser").val(),n=parseInt($("input[name=event_relay]:checked").val(),10);t==="Generic"?(g_LDA.relay[n-1].total_on_ticks=$("#time_on_chooser").val(),g_LDA.relay[n-1].total_off_ticks=$("#time_off_chooser").val(),g_LDA.feeding_table.update([{id:n,state:"generic"}])):t==="Feeder"?g_LDA.feeding_table.update([{id:n,state:"feeder"}]):g_LDA.feeding_table.update([{id:n,state:"inactive"}])});$("input[name=event_relay]:radio").change(function(){var n=$(this).val();n===""?t.queries.remove("relay_number"):t.queries.add("relay_number",n);t.process();write_log_table(n)})});
/*
//# sourceMappingURL=IMRelay_vis.min.js.map
*/