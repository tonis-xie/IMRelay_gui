function enable_vis_timeline_button_classes(n){$("#vis_controls_id_"+n+" button:nth-child(2)").hasClass("btn-warning")?($("#vis_controls_id_"+n+" button:nth-child(2)").removeClass("active"),$("#vis_controls_id_"+n+" button:nth-child(3)").addClass("active"),$("#vis_controls_id_"+n+" button:nth-child(4)").removeClass("active")):($("#vis_controls_id_"+n+" button:nth-child(2)").addClass("active"),$("#vis_controls_id_"+n+" button:nth-child(3)").removeClass("active"),$("#vis_controls_id_"+n+" button:nth-child(4)").removeClass("active"),$("#vis_controls_id_"+n+" div:nth-child(1)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default"),$("#vis_controls_id_"+n+" button:nth-child(2)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default"),$("#vis_controls_id_"+n+" button:nth-child(3)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default"),$("#vis_controls_id_"+n+" button:nth-child(4)").addClass("btn-success").removeClass("btn-warning").removeClass("btn-default"))}function disable_vis_timeline_button_classes(n){$("#vis_controls_id_"+n+" button:nth-child(2)").removeClass("active");$("#vis_controls_id_"+n+" button:nth-child(3)").removeClass("active");$("#vis_controls_id_"+n+" button:nth-child(4)").addClass("active");$("#vis_controls_id_"+n+" div:nth-child(1)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(2)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(3)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default");$("#vis_controls_id_"+n+" button:nth-child(4)").removeClass("btn-success").removeClass("btn-warning").addClass("btn-default")}var g_LDA={};g_LDA.relay=[];g_LDA.feed=[];$(document).ready(function(){"use strict";function f(n){var t=document.createElement("button");return t.className="btn btn-default",t.type="button",t.id="toogle_edit_button"+n,t.innerText=n+": Edit",'<td style="width:65px;">'+t.outerHTML+"<\/td>"}function e(n,t,i){var u=n.attributeWriter(t),r="<td";return(n.hidden||n.textAlign)&&(r+=' style="',n.textAlign&&(r+="text-align: "+n.textAlign+";"),r+='"'),i&&(r+=' class="user_editable"'),r+">"+u+"<\/td>"}function o(n){return $.inArray(n,["relay_name","nr_of_fish","nr_of_dead_fish","avg_fish_kg","feeder_speed_kg_pr_min","feeding_percent","growth_factor"])!==-1?!0:!1}function s(n,t,i,r){var s="",u,e,h;for(t.biomass=(t.nr_of_fish-t.nr_of_dead_fish)*t.avg_fish_kg/1e3,t.required_feed_pr_day=t.biomass*t.feeding_percent/100,t.time_feeder_active=+(t.required_feed_pr_day/t.feeder_speed_kg_pr_min*60).toFixed(0),isNaN(g_LDA.feed[n])&&(g_LDA.feed[n]=0),t.feed_progress_today=(+g_LDA.feed[n]).toFixed(3),u=100*t.time_feeder_active/t.time_feeding_intervals,t.feeder_toggle_speed=u<.1?"<0.1":u<1?u.toFixed(1):u.toFixed(0),g_LDA.relay[n]=t.state==="generic"?{type:"generic",total_on_ticks:t.time_feeder_active,total_off_ticks:t.time_feeding_intervals-t.time_feeder_active,toggle_factor:0,on_ticks_remaining:0,off_ticks_remaining:0,accumulate:0,on:0,off:0}:{type:"feeder",total_on_ticks:t.time_feeder_active,total_off_ticks:t.time_feeding_intervals-t.time_feeder_active,toggle_factor:t.time_feeder_active/t.time_feeding_intervals,on_ticks_remaining:t.time_feeder_active,off_ticks_remaining:t.time_feeding_intervals-t.time_feeder_active,accumulate:0,on:0,off:0},t.avg_fish_kg=(+t.avg_fish_kg).toFixed(0),t.biomass=(+t.biomass).toFixed(0),t.required_feed_pr_day=(+t.required_feed_pr_day).toFixed(3),t.time_feeder_active=(t.time_feeder_active/60).toFixed(1),t.time_feeding_intervals=(t.time_feeding_intervals/60).toFixed(1),$("#imrelay_knob_row > div > div div.knob_label_below").eq(n).text(t.relay_name),$("#jknob"+(n+1)).val(u).trigger("change"),u>90?$("#jknob"+(n+1)).trigger("configure",{fgColor:"red"}):$("#jknob"+(n+1)).trigger("configure",{fgColor:"#1f8dff"}),s+=f(t.id),e=1,h=i.length;e<h;e++)s+=r(i[e],t,o(i[e].id));return"<tr>"+s+"<\/tr>"}function h(t){$("#toogle_edit_button"+t).click(function(){var e=$("table#feeding_table tr:nth-child("+t+") td.user_editable"),u=e.is(".active"),r,f,i;if(this.innerHTML=u?t+": Edit":t+": Save",e.prop("contenteditable",!u).toggleClass("active"),u){for(r=n.records.getFromTable(),f=[],i=0;i<r.length;i++)f.push({id:i+1,relay_name:r[i].relay_name,nr_of_fish:r[i].nr_of_fish,nr_of_dead_fish:r[i].nr_of_dead_fish,avg_fish_kg:r[i].avg_fish_kg,feeder_speed_kg_pr_min:r[i].feeder_speed_kg_pr_min,feeding_percent:r[i].feeding_percent,growth_factor:r[i].growth_factor});g_LDA.feeding_table.update(f)}})}function c(n){n.forEach(function(n){n.state==="feeder"&&g_LDA.log_table.add({relay_number:n.id,date:moment().subtract(1,"days").format("YYYY-MM-DD"),relay_name:n.relay_name,nr_of_fish:n.nr_of_fish,nr_of_dead_fish:n.nr_of_dead_fish,avg_fish_kg:n.avg_fish_kg,biomass:n.biomass,feeder_speed_kg_pr_min:n.feeder_speed_kg_pr_min,feeding_percent:n.feeding_percent,required_feed_pr_day:n.required_feed_pr_day,growth_factor:n.growth_factor,feed_progress_today:g_LDA.feed[n.id-1],time_feeder_active:n.time_feeder_active,time_feeding_intervals:n.time_feeding_intervals,feeder_toggle_speed:n.feeder_toggle_speed})})}function r(t){var i,u,f,e;if(!t){i=g_LDA.feeding_table.get();c(n.settings.dataset.records);for(u in i)i[u].state==="feeder"&&(i[u].nr_of_fish=i[u].nr_of_fish-i[u].nr_of_dead_fish,+g_LDA.feed[u]>0&&(i[u].avg_fish_kg=+i[u].avg_fish_kg+1e3*+g_LDA.feed[u]/+i[u].nr_of_fish/+i[u].growth_factor));g_LDA.feeding_table.update([{id:1,nr_of_fish:i[0].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[0].avg_fish_kg,feed_progress_today:0},{id:2,nr_of_fish:i[1].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[1].avg_fish_kg,feed_progress_today:0},{id:3,nr_of_fish:i[2].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[2].avg_fish_kg,feed_progress_today:0},{id:4,nr_of_fish:i[3].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[3].avg_fish_kg,feed_progress_today:0},{id:5,nr_of_fish:i[4].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[4].avg_fish_kg,feed_progress_today:0},{id:6,nr_of_fish:i[5].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[5].avg_fish_kg,feed_progress_today:0},{id:7,nr_of_fish:i[6].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[6].avg_fish_kg,feed_progress_today:0},{id:8,nr_of_fish:i[7].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[7].avg_fish_kg,feed_progress_today:0},{id:9,nr_of_fish:i[8].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[8].avg_fish_kg,feed_progress_today:0},{id:10,nr_of_fish:i[9].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[9].avg_fish_kg,feed_progress_today:0},{id:11,nr_of_fish:i[10].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[10].avg_fish_kg,feed_progress_today:0},{id:12,nr_of_fish:i[11].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[11].avg_fish_kg,feed_progress_today:0},{id:13,nr_of_fish:i[12].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[12].avg_fish_kg,feed_progress_today:0},{id:14,nr_of_fish:i[13].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[13].avg_fish_kg,feed_progress_today:0},{id:15,nr_of_fish:i[14].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[14].avg_fish_kg,feed_progress_today:0},{id:16,nr_of_fish:i[15].nr_of_fish,nr_of_dead_fish:0,avg_fish_kg:i[15].avg_fish_kg,feed_progress_today:0}]);window.location.reload()}f=new Date;e=(new Date).setHours(24,0,0,0);window.setTimeout(r,e-f)}var i,u,t,n;$("table#feeding_table").on("input","td",function(){$.isNumeric($(this).html())?$(this).css("color","green"):$(this).css("color","red")});$("table#feeding_table").on("keypress","td",function(n){var t=new RegExp("^[a-zA-Z0-9.]+$"),i=String.fromCharCode(n.which);return t.test(i)?!0:(n.preventDefault(),!1)});if(g_LDA.feeding_table=new vis.DataSet,i=localStorage["feeder.table"],i!=null)u=JSON.parse(i),g_LDA.feeding_table.update(u);else for(t=1;t<=16;t++)g_LDA.feeding_table.add({id:t,relay_name:"",state:"inactive",nr_of_fish:"0",nr_of_dead_fish:"0",avg_fish_kg:"0",feeder_speed_kg_pr_min:"0",feeding_percent:"0",growth_factor:"0",feed_progress_today:"0",time_feeding_intervals:"0"});g_LDA.feeding_table.on("*",function(){var i=g_LDA.groups.get({fields:["id","className"]}),r=g_LDA.feeding_table.get(),t;localStorage["feeder.table"]=JSON.stringify(r);for(t in r)r[t].state==="inactive"?(i[t].className="vis_group_disabled",disable_vis_timeline_button_classes(i[t].id)):(i[t].className="vis_group_enabled",enable_vis_timeline_button_classes(i[t].id));g_LDA.groups.update(i);n.settings.dataset.originalRecords=r;n.process()});$("#feeding_table").dynatable({features:{paginate:!1,sorting:!1,recordCount:!1,search:!1},dataset:{records:g_LDA.feeding_table.get()},writers:{_rowWriter:s,_cellWriter:e}}).bind("dynatable:afterProcess",function(){for(var n=1;n<=16;n++)h(n)});n=$("#feeding_table").data("dynatable");n.sorts.clear();n.sorts.add("id",1);n.process();r(!0)});
/*
//# sourceMappingURL=IMRelay_feeding_table.min.js.map
*/