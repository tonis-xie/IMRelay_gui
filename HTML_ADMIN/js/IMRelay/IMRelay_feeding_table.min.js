var g_LDA={};g_LDA.relay=[];g_LDA.feed=[];$(function(){function f(n){var t=document.createElement("button");return t.className="btn btn-default",t.type="button",t.id="toogle_edit_button"+n,t.innerText=n+": Edit",'<td style="width:65px;">'+t.outerHTML+"<\/td>"}function e(n,t,i){var u=n.attributeWriter(t),r="<td";return(n.hidden||n.textAlign)&&(r+=' style="',n.textAlign&&(r+="text-align: "+n.textAlign+";"),r+='"'),i&&(r+=' class="user_editable"'),r+">"+u+"<\/td>"}function o(n){return $.inArray(n,["nr_of_fish","avg_fish_kg","feeder_speed_kg_pr_min","feeding_percent","growth_factor"])!==-1?!0:!1}function s(n,t,i,r){var s="",h=new Date(t.start_date),l=h.getFullYear().toString()+"-"+("0"+(h.getMonth()+1).toString()).slice(-2)+"-"+("0"+h.getDate().toString()).slice(-2),e,u,c;for(t.start_date=l,t.biomass=t.nr_of_fish*t.avg_fish_kg/1e3,t.required_feed_pr_day=t.biomass*t.feeding_percent/100,t.time_feeder_active=+(t.required_feed_pr_day/t.feeder_speed_kg_pr_min*60).toFixed(0),isNaN(g_LDA.feed[n])&&(g_LDA.feed[n]=0),t.feed_progress_today=g_LDA.feed[n].toFixed(1),e=100*t.time_feeder_active/t.time_feeding_intervals,t.feeder_toggle_speed=e.toFixed(0),g_LDA.relay[n]={total_on_ticks:t.time_feeder_active,total_off_ticks:t.time_feeding_intervals-t.time_feeder_active,toggle_factor:t.time_feeder_active/t.time_feeding_intervals,on_ticks_remaining:t.time_feeder_active,off_ticks_remaining:t.time_feeding_intervals-t.time_feeder_active,accumulate:0,on:0,off:0},t.avg_fish_kg=(+t.avg_fish_kg).toFixed(0),t.biomass=(+t.biomass).toFixed(0),t.required_feed_pr_day=(+t.required_feed_pr_day).toFixed(3),t.time_feeder_active=(t.time_feeder_active/60).toFixed(1),t.time_feeding_intervals=(t.time_feeding_intervals/60).toFixed(1),$("#jknob"+(n+1)).val(e).trigger("change"),e>90?$("#jknob"+(n+1)).trigger("configure",{fgColor:"red"}):$("#jknob"+(n+1)).trigger("configure",{fgColor:"#1f8dff"}),s+=f(t.id),u=1,c=i.length;u<c;u++)s+=r(i[u],t,o(i[u].id));return"<tr>"+s+"<\/tr>"}function h(t){$("#toogle_edit_button"+t).click(function(){var u=$("table#feeding_table tr:nth-child("+t+") td.user_editable"),r=u.is(".editable"),i;this.innerHTML=r?t+": Edit":t+": Save";u.prop("contenteditable",!r).toggleClass("editable");r&&(i=n.records.getFromTable()[t-1],g_LDA.feeding_table.update([{id:t,nr_of_fish:i.nr_of_fish,avg_fish_kg:i.avg_fish_kg,feeder_speed_kg_pr_min:i.feeder_speed_kg_pr_min,feeding_percent:i.feeding_percent,growth_factor:i.growth_factor}]))})}function r(n){var t,i,u,f;if(!n){t=g_LDA.feeding_table.get();for(i in t)t[i].state==="active"&&(t[i].avg_fish_kg=+t[i].avg_fish_kg+t[i].avg_fish_kg*t[i].feeding_percent/100*t[i].growth_factor);g_LDA.feeding_table.update([{id:1,avg_fish_kg:t[0].avg_fish_kg,feed_progress_today:0},{id:2,avg_fish_kg:t[1].avg_fish_kg,feed_progress_today:0},{id:3,avg_fish_kg:t[2].avg_fish_kg,feed_progress_today:0},{id:4,avg_fish_kg:t[3].avg_fish_kg,feed_progress_today:0},{id:5,avg_fish_kg:t[4].avg_fish_kg,feed_progress_today:0},{id:6,avg_fish_kg:t[5].avg_fish_kg,feed_progress_today:0},{id:7,avg_fish_kg:t[6].avg_fish_kg,feed_progress_today:0},{id:8,avg_fish_kg:t[7].avg_fish_kg,feed_progress_today:0},{id:9,avg_fish_kg:t[8].avg_fish_kg,feed_progress_today:0},{id:10,avg_fish_kg:t[9].avg_fish_kg,feed_progress_today:0},{id:11,avg_fish_kg:t[10].avg_fish_kg,feed_progress_today:0},{id:12,avg_fish_kg:t[11].avg_fish_kg,feed_progress_today:0},{id:13,avg_fish_kg:t[12].avg_fish_kg,feed_progress_today:0},{id:14,avg_fish_kg:t[13].avg_fish_kg,feed_progress_today:0},{id:15,avg_fish_kg:t[14].avg_fish_kg,feed_progress_today:0},{id:16,avg_fish_kg:t[15].avg_fish_kg,feed_progress_today:0}]);window.location.reload()}u=new Date;f=(new Date).setHours(24,0,0,0);window.setTimeout(r,f-u)}var i,u,t,n;if(g_LDA.feeding_table=new vis.DataSet,i=localStorage["feeder.table"],i!=null)u=JSON.parse(i),g_LDA.feeding_table.update(u);else for(t=1;t<=16;t++)g_LDA.feeding_table.add({id:t,start_date:"0",nr_of_fish:"0",avg_fish_kg:"0",feeder_speed_kg_pr_min:"0",feeding_percent:"0",growth_factor:"0",feed_progress_today:"0",time_feeding_intervals:"0"});g_LDA.feeding_table.on("*",function(){var t=g_LDA.feeding_table.get();localStorage["feeder.table"]=JSON.stringify(t);n.settings.dataset.originalRecords=t;n.process()});$("#feeding_table").dynatable({features:{paginate:!1,sorting:!1,recordCount:!1,search:!1},dataset:{records:g_LDA.feeding_table.get()},writers:{_rowWriter:s,_cellWriter:e}}).bind("dynatable:afterProcess",function(){for(var n=1;n<=16;n++)h(n)});n=$("#feeding_table").data("dynatable");n.sorts.clear();n.sorts.add("id",1);n.process();r(!0)});
/*
//# sourceMappingURL=IMRelay_feeding_table.min.js.map
*/