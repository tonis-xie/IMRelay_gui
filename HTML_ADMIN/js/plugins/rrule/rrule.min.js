/*!
 * rrule.js - Library for working with recurrence rules for calendar dates.
 * https://github.com/jakubroztocil/rrule
 *
 * Copyright 2010, Jakub Roztocil and Lars Schoning
 * Licenced under the BSD licence.
 * https://github.com/jakubroztocil/rrule/blob/master/LICENCE
 *
 * Based on:
 * python-dateutil - Extensions to the standard Python datetime module.
 * Copyright (c) 2003-2011 - Gustavo Niemeyer <gustavo@niemeyer.net>
 * Copyright (c) 2012 - Tomi Pieviläinen <tomi.pievilainen@iki.fi>
 * https://github.com/jakubroztocil/rrule/blob/master/LICENCE
 *
 */
(function(n){var k=typeof module!="undefined"&&module.exports,a=function(){if(!a._nlp)if(k)a._nlp=require("./nlp");else if(!(a._nlp=n._RRuleNLP))throw new Error("You need to include rrule/nlp.js for fromText/toText to work.");return a._nlp},i={MONTH_DAYS:[31,28,31,30,31,30,31,31,30,31,30,31],ONE_DAY:864e5,MAXYEAR:9999,ORDINAL_BASE:new Date(1970,0,1),PY_WEEKDAYS:[6,0,1,2,3,4,5],getYearDay:function(n){var t=new Date(n.getFullYear(),n.getMonth(),n.getDate());return Math.ceil((t-new Date(n.getFullYear(),0,1))/i.ONE_DAY)+1},isLeapYear:function(n){return n instanceof Date&&(n=n.getFullYear()),n%4==0&&n%100!=0||n%400==0},tzOffset:function(n){return n.getTimezoneOffset()*6e4},daysBetween:function(n,t){var r=n.getTime()-i.tzOffset(n),u=t.getTime()-i.tzOffset(t),f=Math.abs(r-u);return Math.round(f/i.ONE_DAY)},toOrdinal:function(n){return i.daysBetween(n,i.ORDINAL_BASE)},fromOrdinal:function(n){var t=n*i.ONE_DAY;return new Date(i.ORDINAL_BASE.getTime()-i.tzOffset(i.ORDINAL_BASE)+t+i.tzOffset(new Date(t)))},monthRange:function(n,t){var r=new Date(n,t,1);return[i.getWeekday(r),i.getMonthDays(r)]},getMonthDays:function(n){var t=n.getMonth();return t==1&&i.isLeapYear(n)?29:i.MONTH_DAYS[t]},getWeekday:function(n){return i.PY_WEEKDAYS[n.getDay()]},combine:function(n,t){return t=t||n,new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},clone:function(n){var t=new Date(n.getTime());return t.setMilliseconds(0),t},cloneDates:function(n){for(var r=[],t=0;t<n.length;t++)r.push(i.clone(n[t]));return r},sort:function(n){n.sort(function(n,t){return n.getTime()-t.getTime()})},timeToUntilString:function(n){for(var t=new Date(n),i,r=[t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),"T",t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),"Z"],u=0;u<r.length;u++)i=r[u],!/[TZ]/.test(i)&&i<10&&(r[u]="0"+String(i));return r.join("")},untilStringToDate:function(n){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/.exec(n);if(!t)throw new Error("Invalid UNTIL value: "+n);return new Date(Date.UTC(t[1],t[2]-1,t[3],t[5]||0,t[6]||0,t[7]||0))}},t,c,v,p;i.Time=function(n,t,i){this.hour=n;this.minute=t;this.second=i};i.Time.prototype={getHours:function(){return this.hour},getMinutes:function(){return this.minute},getSeconds:function(){return this.second},getTime:function(){return(this.hour*3600+this.minute*60+this.second)*1e3}};var l=function(n,t){var r,i;for(arguments.length===1&&(t=n,n=0),r=[],i=n;i<t;i++)r.push(i);return r},u=function(n,t){var i=0,r=[];if(n instanceof Array)for(;i<t;i++)r[i]=[].concat(n);else for(;i<t;i++)r[i]=n;return r},h=function(n,t){var i=n%t;return i*t<0?i+t:i},y=function(n,t){return{div:Math.floor(n/t),mod:h(n,t)}},f=function(n){return n instanceof Array&&n.length==0?!1:Boolean(n)},e=function(n,t){return n.indexOf(t)!=-1},g=[].concat(u(1,31),u(2,28),u(3,31),u(4,30),u(5,31),u(6,30),u(7,31),u(8,31),u(9,30),u(10,31),u(11,30),u(12,31),u(1,7)),nt=[].concat(u(1,31),u(2,29),u(3,31),u(4,30),u(5,31),u(6,30),u(7,31),u(8,31),u(9,30),u(10,31),u(11,30),u(12,31),u(1,7)),w=l(1,29),b=l(1,30),o=l(1,31),r=l(1,32),tt=[].concat(r,b,r,o,r,o,r,r,o,r,o,r,r.slice(0,7)),it=[].concat(r,w,r,o,r,o,r,r,o,r,o,r,r.slice(0,7));w=l(-28,0);b=l(-29,0);o=l(-30,0);r=l(-31,0);var rt=[].concat(r,b,r,o,r,o,r,r,o,r,o,r,r.slice(0,7)),ut=[].concat(r,w,r,o,r,o,r,r,o,r,o,r,r.slice(0,7)),ft=[0,31,60,91,121,152,182,213,244,274,305,335,366],et=[0,31,59,90,120,151,181,212,243,273,304,334,365],d=function(){for(var n=[],t=0;t<55;t++)n=n.concat(l(7));return n}(),s=function(n,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=n;this.n=t};s.prototype={nth:function(n){return this.n==n?this:new s(this.weekday,n)},equals:function(n){return this.weekday==n.weekday&&this.n==n.n},toString:function(){var n=["MO","TU","WE","TH","FR","SA","SU"][this.weekday];return this.n&&(n=(this.n>0?"+":"")+String(this.n)+n),n},getJsWeekday:function(){return this.weekday==6?0:this.weekday+1}};t=function(n,r){var u,o,w,b,h,l,a,c,g,v,nt,y,tt;this._string=null;n=n||{};this._cache=r?null:{all:!1,before:[],after:[],between:[]};this.origOptions={};var p=[],k=Object.keys(n),d=Object.keys(t.DEFAULT_OPTIONS);if(k.forEach(function(t){this.origOptions[t]=n[t];e(d,t)||p.push(t)},this),p.length)throw new Error("Invalid options: "+p.join(", "));if(!t.FREQUENCIES[n.freq]&&n.byeaster===null)throw new Error("Invalid frequency: "+String(n.freq));if(d.forEach(function(i){e(k,i)||(n[i]=t.DEFAULT_OPTIONS[i])}),u=this.options=n,u.byeaster!==null&&(u.freq=t.YEARLY),u.dtstart||(u.dtstart=new Date,u.dtstart.setMilliseconds(0)),u.wkst===null?u.wkst=t.MO.weekday:typeof u.wkst=="number"||(u.wkst=u.wkst.weekday),u.bysetpos!==null)for(typeof u.bysetpos=="number"&&(u.bysetpos=[u.bysetpos]),o=0;o<u.bysetpos.length;o++)if(h=u.bysetpos[o],h==0||!(-366<=h&&h<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1");if(!(f(u.byweekno)||f(u.byyearday)||f(u.bymonthday)||u.byweekday!==null||u.byeaster!==null))switch(u.freq){case t.YEARLY:u.bymonth||(u.bymonth=u.dtstart.getMonth()+1);u.bymonthday=u.dtstart.getDate();break;case t.MONTHLY:u.bymonthday=u.dtstart.getDate();break;case t.WEEKLY:u.byweekday=i.getWeekday(u.dtstart)}if(u.bymonth===null||u.bymonth instanceof Array||(u.bymonth=[u.bymonth]),u.byyearday===null||u.byyearday instanceof Array||(u.byyearday=[u.byyearday]),u.bymonthday===null)u.bymonthday=[],u.bynmonthday=[];else if(u.bymonthday instanceof Array){for(w=[],b=[],o=0;o<u.bymonthday.length;o++)h=u.bymonthday[o],h>0?w.push(h):h<0&&b.push(h);u.bymonthday=w;u.bynmonthday=b}else u.bymonthday<0?(u.bynmonthday=[u.bymonthday],u.bymonthday=[]):(u.bynmonthday=[],u.bymonthday=[u.bymonthday]);if(u.byweekno===null||u.byweekno instanceof Array||(u.byweekno=[u.byweekno]),u.byweekday===null)u.bynweekday=null;else if(typeof u.byweekday=="number")u.byweekday=[u.byweekday],u.bynweekday=null;else if(u.byweekday instanceof s)!u.byweekday.n||u.freq>t.MONTHLY?(u.byweekday=[u.byweekday.weekday],u.bynweekday=null):(u.bynweekday=[[u.byweekday.weekday,u.byweekday.n]],u.byweekday=null);else{for(l=[],a=[],o=0;o<u.byweekday.length;o++)c=u.byweekday[o],typeof c=="number"?l.push(c):!c.n||u.freq>t.MONTHLY?l.push(c.weekday):a.push([c.weekday,c.n]);u.byweekday=f(l)?l:null;u.bynweekday=f(a)?a:null}if(u.byhour===null?u.byhour=u.freq<t.HOURLY?[u.dtstart.getHours()]:null:typeof u.byhour=="number"&&(u.byhour=[u.byhour]),u.byminute===null?u.byminute=u.freq<t.MINUTELY?[u.dtstart.getMinutes()]:null:typeof u.byminute=="number"&&(u.byminute=[u.byminute]),u.bysecond===null?u.bysecond=u.freq<t.SECONDLY?[u.dtstart.getSeconds()]:null:typeof u.bysecond=="number"&&(u.bysecond=[u.bysecond]),u.freq>=t.HOURLY)this.timeset=null;else{for(this.timeset=[],o=0;o<u.byhour.length;o++)for(g=u.byhour[o],v=0;v<u.byminute.length;v++)for(nt=u.byminute[v],y=0;y<u.bysecond.length;y++)tt=u.bysecond[y],this.timeset.push(new i.Time(g,nt,tt));i.sort(this.timeset)}};t.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"];t.YEARLY=0;t.MONTHLY=1;t.WEEKLY=2;t.DAILY=3;t.HOURLY=4;t.MINUTELY=5;t.SECONDLY=6;t.MO=new s(0);t.TU=new s(1);t.WE=new s(2);t.TH=new s(3);t.FR=new s(4);t.SA=new s(5);t.SU=new s(6);t.DEFAULT_OPTIONS={freq:null,dtstart:null,interval:1,wkst:t.MO,count:null,until:null,bysetpos:null,bymonth:null,bymonthday:null,byyearday:null,byweekno:null,byweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null};t.parseText=function(n,t){return a().parseText(n,t)};t.fromText=function(n,t){return a().fromText(n,t)};t.optionsToString=function(n){var l,h,p,r,c,a=[],o,f,v,u,y;for(h=Object.keys(n),p=Object.keys(t.DEFAULT_OPTIONS),u=0;u<h.length;u++)if(e(p,h[u])&&(l=h[u].toUpperCase(),r=n[h[u]],c=[],r!==null&&(!(r instanceof Array)||r.length))){switch(l){case"FREQ":r=t.FREQUENCIES[n.freq];break;case"WKST":r=r.toString();break;case"BYWEEKDAY":for(l="BYDAY",r instanceof Array||(r=[r]),f=0;f<r.length;f++)o=r[f],o instanceof s||(o=o instanceof Array?new s(o[0],o[1]):new s(o)),c[f]=o.toString();r=c;break;case"DTSTART":case"UNTIL":r=i.timeToUntilString(r);break;default:if(r instanceof Array){for(f=0;f<r.length;f++)c[f]=String(r[f]);r=c}else r=String(r)}a.push([l,r])}for(v=[],u=0;u<a.length;u++)y=a[u],v.push(y[0]+"="+y[1].toString());return v.join(";")};t.prototype={all:function(n){if(n)return this._iter(new p("all",{},n));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new v("all",{})),this._cacheAdd("all",t)),t},between:function(n,t,i,r){var f={before:t,after:n,inc:i},u;return r?this._iter(new p("between",f,r)):(u=this._cacheGet("between",f),u===!1&&(u=this._iter(new v("between",f)),this._cacheAdd("between",u,f)),u)},before:function(n,t){var r={dt:n,inc:t},i=this._cacheGet("before",r);return i===!1&&(i=this._iter(new v("before",r)),this._cacheAdd("before",i,r)),i},after:function(n,t){var r={dt:n,inc:t},i=this._cacheGet("after",r);return i===!1&&(i=this._iter(new v("after",r)),this._cacheAdd("after",i,r)),i},count:function(){return this.all().length},toString:function(){return t.optionsToString(this.origOptions)},toText:function(n,t){return a().toText(this,n,t)},isFullyConvertibleToText:function(){return a().isFullyConvertible(this)},_cacheAdd:function(n,t,r){this._cache&&(t&&(t=t instanceof Date?i.clone(t):i.cloneDates(t)),n=="all"?this._cache.all=t:(r._value=t,this._cache[n].push(r)))},_cacheGet:function(n,t){var r,e,f,o,u;if(!this._cache)return!1;if(r=!1,n=="all")r=this._cache.all;else n:for(u=0;u<this._cache[n].length;u++){e=this._cache[n][u];for(f in t)if(t.hasOwnProperty(f)&&String(t[f])!=String(e[f]))continue n;r=e._value;break}if(!r&&this._cache.all){for(o=new v(n,t),u=0;u<this._cache.all.length;u++)if(!o.accept(this._cache.all[u]))break;r=o.getValue();this._cacheAdd(n,r,t)}return r instanceof Array?i.cloneDates(r):r instanceof Date?i.clone(r):r},clone:function(){return new t(this.origOptions)},_iter:function(n){var tt=this.options.dtstart,w=tt.getFullYear(),a=tt.getMonth()+1,it=tt.getDate(),u=tt.getHours(),v=tt.getMinutes(),rt=tt.getSeconds(),gt=i.getWeekday(tt),wi=i.getYearDay(tt),d=this.options.freq,b=this.options.interval,ni=this.options.wkst,ti=this.options.until,ci=this.options.bymonth,yi=this.options.byweekno,wt=this.options.byyearday,li=this.options.byweekday,pi=this.options.byeaster,ai=this.options.bymonthday,vi=this.options.bynmonthday,fi=this.options.bysetpos,ot=this.options.byhour,lt=this.options.byminute,ii=this.options.bysecond,r=new c(this),nt,g,ut,kt,ei,pt,yt,oi,hi,si,ft,dt;r.rebuild(w,a);nt={};nt[t.YEARLY]=r.ydayset;nt[t.MONTHLY]=r.mdayset;nt[t.WEEKLY]=r.wdayset;nt[t.DAILY]=r.ddayset;nt[t.HOURLY]=r.ddayset;nt[t.MINUTELY]=r.ddayset;nt[t.SECONDLY]=r.ddayset;nt=nt[d];d<t.HOURLY?g=this.timeset:(ut={},ut[t.HOURLY]=r.htimeset,ut[t.MINUTELY]=r.mtimeset,ut[t.SECONDLY]=r.stimeset,ut=ut[d],g=d>=t.HOURLY&&f(ot)&&!e(ot,u)||d>=t.MINUTELY&&f(lt)&&!e(lt,v)||d>=t.SECONDLY&&f(ii)&&!e(ii,v)?[]:ut.call(r,u,v,rt));for(var at,et=0,vt=this.options.count,o,p,st,l,s,k,ht,yt,bt,ri,ui,ct;;){for(ht=nt.call(r,w,a,it),bt=ht[0],ri=ht[1],ui=ht[2],at=!1,p=ri;p<ui;p++)o=bt[p],(f(ci)&&!e(ci,r.mmask[o])||f(yi)&&!r.wnomask[o]||f(li)&&!e(li,r.wdaymask[o])||f(r.nwdaymask)&&!r.nwdaymask[o]||pi!==null&&!e(r.eastermask,o)||(f(ai)||f(vi))&&!e(ai,r.mdaymask[o])&&!e(vi,r.nmdaymask[o])||f(wt)&&(o<r.yearlen&&!e(wt,o+1)&&!e(wt,-r.yearlen+o)||o>=r.yearlen&&!e(wt,o+1-r.yearlen)&&!e(wt,-r.nextyearlen+o-r.yearlen)))&&(bt[o]=null,at=!0);if(f(fi)&&f(g)){for(pt=[],o,p=0;p<fi.length;p++){yt=fi[p];yt<0?(kt=Math.floor(yt/g.length),ei=h(yt,g.length)):(kt=Math.floor((yt-1)/g.length),ei=h(yt-1,g.length));try{for(ht=[],st=ri;st<ui;st++)(oi=bt[st],oi!==null)&&ht.push(oi);o=kt<0?ht.slice(kt)[0]:ht[kt];var si=g[ei],hi=i.fromOrdinal(r.yearordinal+o),ft=i.combine(hi,si);e(pt,ft)||pt.push(ft)}catch(bi){}}for(i.sort(pt),p=0;p<pt.length;p++){if(ft=pt[p],ti&&ft>ti)return this._len=et,n.getValue();if(ft>=tt){if(++et,!n.accept(ft))return n.getValue();if(vt&&(--vt,!vt))return this._len=et,n.getValue()}}}else for(p=ri;p<ui;p++)if(o=bt[p],o!==null)for(hi=i.fromOrdinal(r.yearordinal+o),st=0;st<g.length;st++){if(si=g[st],ft=i.combine(hi,si),ti&&ft>ti)return this._len=et,n.getValue();if(ft>=tt){if(++et,!n.accept(ft))return n.getValue();if(vt&&(--vt,!vt))return this._len=et,n.getValue()}}if(ct=!1,d==t.YEARLY){if(w+=b,w>i.MAXYEAR)return this._len=et,n.getValue();r.rebuild(w,a)}else if(d==t.MONTHLY){if(a+=b,a>12&&(s=Math.floor(a/12),k=h(a,12),a=k,w+=s,a==0&&(a=12,--w),w>i.MAXYEAR))return this._len=et,n.getValue();r.rebuild(w,a)}else if(d==t.WEEKLY)it+=ni>gt?-(gt+1+(6-ni))+b*7:-(gt-ni)+b*7,gt=ni,ct=!0;else if(d==t.DAILY)it+=b,ct=!0;else if(d==t.HOURLY){for(at&&(u+=Math.floor((23-u)/b)*b);;)if(u+=b,l=y(u,24),s=l.div,k=l.mod,s&&(u=k,it+=s,ct=!0),!f(ot)||e(ot,u))break;g=ut.call(r,u,v,rt)}else if(d==t.MINUTELY){for(at&&(v+=Math.floor((1439-(u*60+v))/b)*b);;)if(v+=b,l=y(v,60),s=l.div,k=l.mod,s&&(v=k,u+=s,l=y(u,24),s=l.div,k=l.mod,s&&(u=k,it+=s,ct=!0,at=!1)),(!f(ot)||e(ot,u))&&(!f(lt)||e(lt,v)))break;g=ut.call(r,u,v,rt)}else if(d==t.SECONDLY){for(at&&(rt+=Math.floor((86399-(u*3600+v*60+rt))/b)*b);;)if(rt+=b,l=y(rt,60),s=l.div,k=l.mod,s&&(rt=k,v+=s,l=y(v,60),s=l.div,k=l.mod,s&&(v=k,u+=s,l=y(u,24),s=l.div,k=l.mod,s&&(u=k,it+=s,ct=!0))),(!f(ot)||e(ot,u))&&(!f(lt)||e(lt,v))&&(!f(ii)||e(ii,rt)))break;g=ut.call(r,u,v,rt)}if(ct&&it>28&&(dt=i.monthRange(w,a-1)[1],it>dt)){while(it>dt){if(it-=dt,++a,a==13&&(a=1,++w,w>i.MAXYEAR))return this._len=et,n.getValue();dt=i.monthRange(w,a-1)[1]}r.rebuild(w,a)}}}};t.parseString=function(n){var c,f,o,r,l,a,u,y,h,e,v;if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;for(a=n.split(";"),u={},c=0;c<a.length;c++){l=a[c].split("=");o=l[0];r=l[1];switch(o){case"FREQ":u.freq=t[r];break;case"WKST":u.wkst=t[r];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":if(r.indexOf(",")!=-1)for(r=r.split(","),f=0;f<r.length;f++)/^[+-]?\d+$/.test(r[f])&&(r[f]=Number(r[f]));else/^[+-]?\d+$/.test(r)&&(r=Number(r));o=o.toLowerCase();u[o]=r;break;case"BYDAY":for(v=r.split(","),u.byweekday=[],f=0;f<v.length;f++)e=v[f],e.length==2?(h=t[e],u.byweekday.push(h)):(e=e.match(/^([+-]?\d)([A-Z]{2})$/),y=Number(e[1]),h=e[2],h=t[h].weekday,u.byweekday.push(new s(h,y)));break;case"DTSTART":u.dtstart=i.untilStringToDate(r);break;case"UNTIL":u.until=i.untilStringToDate(r);break;case"BYEASTER":u.byeaster=Number(r);break;default:throw new Error("Unknown RRULE property '"+o+"'");}}return u};t.fromString=function(n){return new t(t.parseString(n))};c=function(n){this.rrule=n;this.lastyear=null;this.lastmonth=null;this.yearlen=null;this.nextyearlen=null;this.yearordinal=null;this.yearweekday=null;this.mmask=null;this.mrange=null;this.mdaymask=null;this.nmdaymask=null;this.wdaymask=null;this.wnomask=null;this.nwdaymask=null;this.eastermask=null};c.prototype.easter=function(n,t){t=t||0;var f=n%19,i=Math.floor(n/100),e=n%100,s=Math.floor(i/4),h=i%4,c=Math.floor((i+8)/25),l=Math.floor((i-c+1)/3),r=Math.floor(19*f+i-s-l+15)%30,a=Math.floor(e/4),v=e%4,u=Math.floor(32+2*h+2*a-r-v)%7,o=Math.floor((f+11*r+22*u)/451),y=Math.floor((r+u-7*o+114)/31),p=(r+u-7*o+114)%31+1,w=Date.UTC(n,y-1,p+t),b=Date.UTC(n,0,1);return[Math.ceil((w-b)/864e5)]};c.prototype.rebuild=function(n,r){var o=this.rrule,ot,l,w,b,k,s,y,c,v,p,a;if(n!=this.lastyear)if(this.yearlen=i.isLeapYear(n)?366:365,this.nextyearlen=i.isLeapYear(n+1)?366:365,ot=new Date(n,0,1),this.yearordinal=i.toOrdinal(ot),this.yearweekday=i.getWeekday(ot),p=i.getWeekday(new Date(n,0,1)),this.yearlen==365?(this.mmask=[].concat(g),this.mdaymask=[].concat(it),this.nmdaymask=[].concat(ut),this.wdaymask=d.slice(p),this.mrange=[].concat(et)):(this.mmask=[].concat(nt),this.mdaymask=[].concat(tt),this.nmdaymask=[].concat(rt),this.wdaymask=d.slice(p),this.mrange=[].concat(ft)),f(o.options.byweekno)){this.wnomask=u(0,this.yearlen+7);l=w=h(7-this.yearweekday+o.options.wkst,7);l>=4?(l=0,b=this.yearlen+h(this.yearweekday-o.options.wkst,7)):b=this.yearlen-l;var yt=Math.floor(b/7),pt=h(b,7),st=Math.floor(yt+pt/4);for(c=0;c<o.options.byweekno.length;c++)if(a=o.options.byweekno[c],a<0&&(a+=st+1),0<a&&a<=st)for(a>1?(s=l+(a-1)*7,l!=w&&(s-=7-w)):s=l,v=0;v<7;v++)if(this.wnomask[s]=1,s++,this.wdaymask[s]==o.options.wkst)break;if(e(o.options.byweekno,1)&&(s=l+st*7,l!=w&&(s-=7-w),s<this.yearlen))for(c=0;c<7;c++)if(this.wnomask[s]=1,s+=1,this.wdaymask[s]==o.options.wkst)break;if(l){if(e(o.options.byweekno,-1))k=-1;else{var ct=i.getWeekday(new Date(n-1,0,1)),lt=h(7-ct+o.options.wkst,7),wt=i.isLeapYear(n-1)?366:365;lt>=4?(lt=0,k=Math.floor(52+h(wt+h(ct-o.options.wkst,7),7)/4)):k=Math.floor(52+h(this.yearlen-l,7)/4)}if(e(o.options.byweekno,k))for(s=0;s<l;s++)this.wnomask[s]=1}}else this.wnomask=null;if(f(o.options.bynweekday)&&(r!=this.lastmonth||n!=this.lastyear)){if(y=[],o.options.freq==t.YEARLY)if(f(o.options.bymonth))for(c=0;c<o.options.bymonth.length;c++)r=o.options.bymonth[c],y.push(this.mrange.slice(r-1,r+1));else y=[[0,this.yearlen]];else o.options.freq==t.MONTHLY&&(y=[this.mrange.slice(r-1,r+1)]);if(f(y))for(this.nwdaymask=u(0,this.yearlen),c=0;c<y.length;c++){var at=y[c],vt=at[0],ht=at[1];for(ht-=1,v=0;v<o.options.bynweekday.length;v++)p=o.options.bynweekday[v][0],a=o.options.bynweekday[v][1],s=a<0?ht+(a+1)*7-h(this.wdaymask[s]-p,7):vt+(a-1)*7+h(7-this.wdaymask[s]+p,7),vt<=s&&s<=ht&&(this.nwdaymask[s]=1)}this.lastyear=n;this.lastmonth=r}o.options.byeaster!==null&&(this.eastermask=this.easter(n,o.options.byeaster))};c.prototype.ydayset=function(){return[l(this.yearlen),0,this.yearlen]};c.prototype.mdayset=function(n,t){for(var r=u(null,this.yearlen),f=this.mrange[t-1],e=this.mrange[t],i=f;i<e;i++)r[i]=i;return[r,f,e]};c.prototype.wdayset=function(n,t,r){for(var e=u(null,this.yearlen+7),f=i.toOrdinal(new Date(n,t-1,r))-this.yearordinal,s=f,o=0;o<7;o++)if(e[f]=f,++f,this.wdaymask[f]==this.rrule.options.wkst)break;return[e,s,f]};c.prototype.ddayset=function(n,t,r){var e=u(null,this.yearlen),f=i.toOrdinal(new Date(n,t-1,r))-this.yearordinal;return e[f]=f,[e,f,f+1]};c.prototype.htimeset=function(n,t,r){for(var f,e=[],u=this.rrule,o=0;o<u.options.byminute.length;o++)for(t=u.options.byminute[o],f=0;f<u.options.bysecond.length;f++)r=u.options.bysecond[f],e.push(new i.Time(n,t,r));return i.sort(e),e};c.prototype.mtimeset=function(n,t,r){for(var u=[],e=this.rrule,f=0;f<e.options.bysecond.length;f++)r=e.options.bysecond[f],u.push(new i.Time(n,t,r));return i.sort(u),u};c.prototype.stimeset=function(n,t,r){return[new i.Time(n,t,r)]};v=function(n,t){this.init(n,t)};v.prototype={init:function(n,t){this.method=n;this.args=t;this._result=[];this.minDate=null;this.maxDate=null;n=="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):n=="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):n=="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))},accept:function(n){var t=this.minDate&&n<this.minDate,i=this.maxDate&&n>this.maxDate;if(this.method=="between"){if(t)return!0;if(i)return!1}else if(this.method=="before"){if(i)return!1}else if(this.method=="after")return t?!0:(this.add(n),!1);return this.add(n)},add:function(n){return this._result.push(n),!0},getValue:function(){switch(this.method){case"all":case"between":return this._result;case"before":case"after":return this._result.length?this._result[this._result.length-1]:null}}};p=function(n,t,i){if(!e(["all","between"],n))throw new Error('Invalid method "'+n+'". Only all and between works with iterator.');this.add=function(n){return i(n,this._result.length)?(this._result.push(n),!0):!1};this.init(n,t)};p.prototype=v.prototype;k&&(module.exports={RRule:t});typeof ender=="undefined"&&(n.RRule=t);typeof define=="function"&&define.amd&&define("rrule",[],function(){return t})})(this);
/*
//# sourceMappingURL=rrule.min.js.map
*/